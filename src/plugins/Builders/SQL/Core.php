<?php
//*****************************************************************************
//*****************************************************************************
/**
* SQL Core Class
*
* @package		SwellCore
* @subpackage	Plugins
* @author 		Christian J. Clark
* @copyright	Copyright (c) Swell Development LLC
* @link			http://www.swelldevelopment.com/
**/
//*****************************************************************************
//*****************************************************************************

namespace SwellDevelopment\SwellCore\Builders\SQL;

abstract class Core
{

    //=========================================================================
	// Class Memebers
    //=========================================================================
    $sql_type = false;
	$db_type = 'mysql';
	$table = [];
	$from = [];
	$where = [];
	$group_by = false;
	$having = [];
	$order_by = false;
	$limit = false;

    //=========================================================================
    //=========================================================================
    // Constructor Method
    //=========================================================================
    //=========================================================================
    public function __construct($db_type=false)
    {
		if ($db_type) {
			$this->db_type = strtolower($db_type);
		}
	}

    //=========================================================================
    //=========================================================================
    // Get Instance Method
    //=========================================================================
    //=========================================================================
    public static function Instance($db_type=false)
    {
        return new static($db_type);
    }

    //=========================================================================
    //=========================================================================
    // To String Method
    //=========================================================================
    //=========================================================================
    public function __toString()
    {
		return $this->Get();
	}

    //=========================================================================
    //=========================================================================
    // Get Method
    //=========================================================================
    //=========================================================================
    public function Get()
    {
		trigger_error('The Get() Method has not been implemented.');
		return false;
	}

    //=========================================================================
    //=========================================================================
	// Format Group By Clause Method
    //=========================================================================
    //=========================================================================
	public function GroupBy($group_by)
	{
		if (!$group_by) {
			$this->group_by = false;
			return $this;
		}
		if (is_array($group_by)) {
			$group_by = implode(', ', $group_by);
		}
		$this->group_by = 'GROUP BY ' . $group_by;
		return $this;
	}

    //=========================================================================
    //=========================================================================
	// Format Order By Clause Method
    //=========================================================================
    //=========================================================================
	public function OrderBy($order_by)
	{
		if (!$order_by) {
			$this->order_by = false;
			return $this;
		}
		if (is_array($order_by)) {
			$order_by = implode(', ', $order_by);
		}
		$this->order_by = 'ORDER BY ' . $order_by;
		return $this;
	}

    //=========================================================================
    //=========================================================================
	// Format Limit Clause Method
    //=========================================================================
    //=========================================================================
	public function Limit($limit, &$params, $args=false)
	{
		if (!$limit) {
			$this->limit = false;
			return this;
		}

		//==================================================================
		// Parameters?
		//==================================================================
		if (!is_array($params)) {
			$params = ($this->db_type == 'mysql') ? (['']) : ([]);
		}

		//==================================================================
		// Build Limit Clause
		//==================================================================
		if ($this->db_type == 'mysql') {
			$params[0] .= 'i';
		}
		$params[] = $limit;
		$this->limit = 'LIMIT ?';

		//==================================================================
		// Return Current Object
		//==================================================================
		return $this;
	}
}
